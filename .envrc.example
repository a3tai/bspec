# BSpec Development Environment
# Uses 1Password CLI for secure secret management
#
# Setup:
#   1. Install direnv: brew install direnv
#   2. Add to shell: eval "$(direnv hook zsh)"
#   3. Install 1Password CLI: brew install 1password-cli
#   4. Copy and customize: cp .envrc.example .envrc
#   5. Allow direnv: direnv allow

# =============================================================================
# 1Password Setup
# =============================================================================

if ! command -v op &> /dev/null; then
    echo "âš ï¸  1Password CLI (op) not found. Install with: brew install 1password-cli"
    return 1
fi

# Sign in once (single biometric prompt, cached for subsequent reads)
if ! op account get &>/dev/null; then
    echo "ðŸ” Authenticating with 1Password..."
    eval "$(op signin)"
fi

# =============================================================================
# AI API Keys
# =============================================================================
# Format: op://VAULT/ITEM/FIELD
# Create an "Environment" item in your 1Password vault with these fields

export GEMINI_API_KEY="$(op read 'op://YourVault/Environment/GEMINI_API_KEY' 2>/dev/null || echo 'NOT_SET')"
export EXA_API_KEY="$(op read 'op://YourVault/Environment/EXA_API_KEY' 2>/dev/null || echo 'NOT_SET')"
export FIRECRAWL_API_KEY="$(op read 'op://YourVault/Environment/FIRECRAWL_API_KEY' 2>/dev/null || echo 'NOT_SET')"
export OPENROUTER_API_KEY="$(op read 'op://YourVault/Environment/OPENROUTER_API_KEY' 2>/dev/null || echo 'NOT_SET')"
export ANTHROPIC_API_KEY="$(op read 'op://YourVault/Environment/ANTHROPIC_API_KEY' 2>/dev/null || echo 'NOT_SET')"
export OPENAI_API_KEY="$(op read 'op://YourVault/Environment/OPENAI_API_KEY' 2>/dev/null || echo 'NOT_SET')"

# =============================================================================
# Cloudflare (for deploying bspec.dev)
# =============================================================================
# Get your account ID from: https://dash.cloudflare.com
# Click on any domain â†’ Overview â†’ Account ID (right sidebar)

export CLOUDFLARE_ACCOUNT_ID="$(op read 'op://YourVault/Environment/CLOUDFLARE_ACCOUNT_ID' 2>/dev/null || echo 'NOT_SET')"

# =============================================================================
# Project Paths
# =============================================================================

export BSPEC_ROOT="$(pwd)"
PATH_add "$BSPEC_ROOT/sdk/cli/bin"

# =============================================================================
# Status
# =============================================================================

echo "âœ“ BSpec environment loaded"
echo "  BSPEC_ROOT: $BSPEC_ROOT"
